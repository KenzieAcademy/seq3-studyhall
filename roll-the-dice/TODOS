TODO:
- move code into separate functions
- write tests